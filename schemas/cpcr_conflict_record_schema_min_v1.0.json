{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CPCR Conflict Record (Minimal)",
  "type": "object",
  "properties": {
    "externality_ledger_present": { "type": "boolean" },
    "plant_metrics": {
      "type": "object",
      "properties": {
        "water_usage_w": { "type": "number" },
        "soil_regen_ratio_sr": { "type": "number" },
        "nutrient_density_n": { "type": "number" }
      },
      "required": [
        "water_usage_w",
        "soil_regen_ratio_sr",
        "nutrient_density_n"
      ],
      "additionalProperties": false
    },
    "irst_metrics": {
      "type": "object",
      "properties": {
        "loop_gain_G": { "type": "number" },
        "update_period_days": { "type": "integer", "minimum": 0 },
        "correction_latency_days": { "type": "integer", "minimum": 0 }
      },
      "required": [
        "loop_gain_G",
        "update_period_days",
        "correction_latency_days"
      ],
      "additionalProperties": false
    },
    "ctgs_metrics": {
      "type": "object",
      "properties": {
        "I_gain_flag": { "type": "integer" },
        "repetitions_count": { "type": "integer", "minimum": 0 },
        "refund_delay_days": { "type": "integer", "minimum": 0 },
        "CCT_detected": { "type": "boolean" }
      },
      "required": [
        "I_gain_flag",
        "repetitions_count"
      ],
      "additionalProperties": false
    },
    "claim": { "type": "string" },
    "plant_breaker": {
      "type": "string",
      "enum": [
        "OK",
        "MONITOR",
        "RESTRICT",
        "COMMONS_PROTECT",
        "AUDIT_LOCK"
      ]
    },
    "irst_breaker": {
      "type": "string",
      "enum": [
        "OK",
        "RUNAWAY",
        "AUDIT_LOCK"
      ]
    },
    "ctgs_breaker": {
      "type": "string",
      "enum": [
        "OK",
        "TRAP_DETECTED",
        "CRITICAL_TRAP"
      ]
    },
    "nitt_breaker": {
      "type": "string",
      "enum": [
        "OK",
        "IDENTITY_EVENT"
      ]
    },
    "actions": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "DEGRADED_MODE",
          "CAP_THROTTLE",
          "DISCLOSURE_REQUIRED",
          "ISOLATE",
          "FREEZE_INGESTION",
          "FREEZE_LOOPS",
          "ROLLBACK"
        ]
      }
    },
    "disallowed_actions": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "SCALE_UP",
          "EXPANSION",
          "SELF_TRAINING_UPDATES",
          "FORCED_PATHING",
          "UNDISCLOSED_UPSELL",
          "TELEPORT_SURVIVAL_CLAIMS"
        ]
      }
    },
    "ethical_risk_index": {
      "type": "string",
      "enum": [
        "COMPUTABLE",
        "UNDETERMINED",
        "REFUSED",
        "DEGRADED"
      ]
    },
    "refusal_state": { "type": "string" },
    "timestamp": { "type": "string", "format": "date-time" },
    "audit_hash_sha256": { "type": "string" },
    "ots_receipt_ref": { "type": "string" }
  },
  "required": [
    "externality_ledger_present",
    "plant_metrics",
    "irst_metrics",
    "ctgs_metrics",
    "claim",
    "actions",
    "disallowed_actions"
  ],
  "additionalProperties": false
}
